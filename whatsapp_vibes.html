<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Emoji Analyzer</title>
    <script type="module" src="https://unpkg.com/@zip.js/zip.js@2.7.34/dist/zip-full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}:root{--primary-color:#25D366;--primary-dark:#128C7E;--secondary-color:#075E54;--background:#f0f2f5;--surface:#ffffff;--text-primary:#111b21;--text-secondary:#667781;--border:#e9edef;--error:#dc3545;--shadow:0 2px 8px rgba(0,0,0,0.1)}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;background-color:var(--background);color:var(--text-primary);line-height:1.6;min-height:100vh;display:flex;flex-direction:column}.container{width:100%;max-width:1200px;margin:0 auto;padding:0 20px;flex:1;display:flex;flex-direction:column}header{text-align:center;padding:40px 0 30px}h1{font-size:2.5rem;color:var(--secondary-color);margin-bottom:10px}.subtitle{color:var(--text-secondary);font-size:1.1rem}main{flex:1;display:flex;align-items:center;justify-content:center;padding:20px 0}.upload-container{width:100%;max-width:600px}.drop-zone{background:var(--surface);border:2px dashed var(--border);border-radius:12px;padding:60px 40px;text-align:center;transition:all .3s ease;cursor:pointer}.drop-zone.dragover{border-color:var(--primary-color);background-color:#f0faf4;transform:scale(1.02)}.upload-icon{color:var(--primary-color);margin-bottom:20px}.drop-zone h2{color:var(--text-primary);margin-bottom:15px;font-size:1.5rem}.drop-zone p{color:var(--text-secondary);margin:10px 0}.upload-hint{font-size:.9rem;margin-top:20px}.btn-primary,.btn-secondary{padding:12px 24px;border:none;border-radius:8px;font-size:1rem;font-weight:500;cursor:pointer;transition:all .3s ease;text-decoration:none;display:inline-block}.btn-primary{background-color:var(--primary-color);color:white}.btn-primary:hover{background-color:var(--primary-dark);transform:translateY(-1px);box-shadow:var(--shadow)}.btn-secondary{background-color:var(--surface);color:var(--primary-color);border:2px solid var(--primary-color)}.btn-secondary:hover{background-color:var(--primary-color);color:white}.loading-container{text-align:center}.loader{width:50px;height:50px;border:3px solid var(--border);border-top-color:var(--primary-color);border-radius:50%;margin:0 auto 20px;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.results-container{width:100%;max-width:900px}.results-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;flex-wrap:wrap;gap:20px}.results-header h2{color:var(--secondary-color);font-size:2rem}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:40px}.stat-card{background:var(--surface);padding:25px;border-radius:12px;text-align:center;box-shadow:var(--shadow)}.stat-card h3{color:var(--text-secondary);font-size:.9rem;font-weight:500;margin-bottom:10px;text-transform:uppercase}.stat-value{font-size:2.5rem;font-weight:bold;color:var(--primary-color)}.chart-container{background:var(--surface);padding:30px;border-radius:12px;box-shadow:var(--shadow);margin-bottom:30px;height:400px}.chart-wrapper{width:100%;height:350px;position:relative}.emoji-list{background:var(--surface);padding:30px;border-radius:12px;box-shadow:var(--shadow);max-height:600px;overflow-y:auto}.emoji-item{display:flex;align-items:center;justify-content:space-between;padding:15px 0;border-bottom:1px solid var(--border)}.emoji-item:last-child{border-bottom:none}.emoji-char{font-size:2rem;margin-right:20px}.emoji-count{display:flex;align-items:center;gap:15px}.count-bar{height:8px;background-color:var(--primary-color);border-radius:4px;min-width:20px;transition:width .5s ease}.count-number{font-weight:600;color:var(--text-secondary);min-width:50px;text-align:right}.error-container{text-align:center}.error-content{background:var(--surface);padding:60px 40px;border-radius:12px;box-shadow:var(--shadow)}.error-icon{color:var(--error);margin-bottom:20px}.error-content h2{color:var(--text-primary);margin-bottom:15px}#error-message{color:var(--text-secondary);margin-bottom:30px}.modal{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px}.modal-content{background:var(--surface);padding:40px;border-radius:12px;max-width:600px;width:100%;max-height:80vh;overflow-y:auto;position:relative}.close-modal{position:absolute;top:20px;right:20px;font-size:2rem;cursor:pointer;color:var(--text-secondary);transition:color .3s}.close-modal:hover{color:var(--text-primary)}.export-instructions h3{color:var(--primary-color);margin:20px 0 10px}.export-instructions ol{margin-left:20px;color:var(--text-secondary)}.export-instructions li{margin-bottom:8px}footer{text-align:center;padding:40px 0;color:var(--text-secondary);font-size:.9rem}.footer-links{margin-top:10px}.footer-links a{color:var(--primary-color);text-decoration:none;transition:color .3s}.footer-links a:hover{color:var(--primary-dark);text-decoration:underline}.hidden{display:none!important}@media (max-width:768px){h1{font-size:2rem}.drop-zone{padding:40px 20px}.modal-content{padding:30px 20px}.stats-grid{grid-template-columns:1fr}.chart-container{height:300px;padding:20px}.results-header{justify-content:center;text-align:center}}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>WhatsApp Emoji Analyzer</h1>
            <p class="subtitle">Discover your most used emojis from WhatsApp chats</p>
        </header>

        <main>
            <!-- Upload Section -->
            <section id="upload-section" class="upload-container">
                <div id="drop-zone" class="drop-zone">
                    <svg class="upload-icon" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    <h2>Drop your WhatsApp archive here</h2>
                    <p>or</p>
                    <button class="btn-primary" id="file-select-btn">Choose File</button>
                    <input type="file" id="file-input" accept=".zip,.txt" hidden>
                    <p class="upload-hint">Upload a WhatsApp chat export (ZIP or TXT file)</p>
                </div>
            </section>

            <!-- Loading Section -->
            <section id="loading-section" class="loading-container hidden">
                <div class="loader"></div>
                <p>Analyzing your emojis...</p>
            </section>

            <!-- Results Section -->
            <section id="results-section" class="results-container hidden">
                <div class="results-header">
                    <h2>Your Emoji Analysis</h2>
                    <button class="btn-secondary" id="new-analysis-btn">New Analysis</button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Emojis</h3>
                        <p class="stat-value" id="total-emojis">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Unique Emojis</h3>
                        <p class="stat-value" id="unique-emojis">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Top Emoji</h3>
                        <p class="stat-value" id="top-emoji">-</p>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-wrapper">
                        <canvas id="emoji-chart"></canvas>
                    </div>
                </div>

                <div class="emoji-list" id="emoji-list">
                    <!-- Emoji list will be populated here -->
                </div>
            </section>

            <!-- Error Section -->
            <section id="error-section" class="error-container hidden">
                <div class="error-content">
                    <svg class="error-icon" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    <h2>Oops! Something went wrong</h2>
                    <p id="error-message">Unable to process the file</p>
                    <button class="btn-primary" id="try-again-btn">Try Again</button>
                </div>
            </section>
        </main>

        <footer>
            <p>All processing happens in your browser. No data is uploaded to any server.</p>
            <p class="footer-links">
                <a href="#" id="how-to-export">How to export WhatsApp chat</a>
            </p>
        </footer>
    </div>

    <!-- How to Export Modal -->
    <div id="export-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>How to Export WhatsApp Chat</h2>
            <div class="export-instructions">
                <h3>On Android:</h3>
                <ol>
                    <li>Open the WhatsApp chat you want to export</li>
                    <li>Tap the three dots menu (⋮) in the top right</li>
                    <li>Select "More" → "Export chat"</li>
                    <li>Choose "Without media" for faster processing</li>
                    <li>Save or share the ZIP file</li>
                </ol>
                
                <h3>On iPhone:</h3>
                <ol>
                    <li>Open the WhatsApp chat you want to export</li>
                    <li>Tap the contact name at the top</li>
                    <li>Scroll down and tap "Export Chat"</li>
                    <li>Choose "Without Media"</li>
                    <li>Save or share the ZIP file</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        const dropZone=document.getElementById('drop-zone'),fileInput=document.getElementById('file-input'),fileSelectBtn=document.getElementById('file-select-btn'),uploadSection=document.getElementById('upload-section'),loadingSection=document.getElementById('loading-section'),resultsSection=document.getElementById('results-section'),errorSection=document.getElementById('error-section'),errorMessage=document.getElementById('error-message'),newAnalysisBtn=document.getElementById('new-analysis-btn'),tryAgainBtn=document.getElementById('try-again-btn'),exportModal=document.getElementById('export-modal'),howToExportLink=document.getElementById('how-to-export'),closeModalBtn=document.querySelector('.close-modal');let emojiChart=null;fileSelectBtn.addEventListener('click',()=>fileInput.click()),fileInput.addEventListener('change',handleFileSelect),dropZone.addEventListener('dragover',handleDragOver),dropZone.addEventListener('dragleave',handleDragLeave),dropZone.addEventListener('drop',handleDrop),newAnalysisBtn.addEventListener('click',resetAnalysis),tryAgainBtn.addEventListener('click',resetAnalysis),howToExportLink.addEventListener('click',showExportModal),closeModalBtn.addEventListener('click',hideExportModal),window.addEventListener('click',e=>{e.target===exportModal&&hideExportModal()});function handleFileSelect(e){const t=e.target.files[0];t&&('application/zip'===t.type||t.name.endsWith('.zip')?processZipFile(t):'text/plain'===t.type||t.name.endsWith('.txt')?processTextFile(t):showError('Please upload a valid ZIP or TXT file'))}function handleDragOver(e){e.preventDefault(),dropZone.classList.add('dragover')}function handleDragLeave(e){e.preventDefault(),dropZone.classList.remove('dragover')}function handleDrop(e){e.preventDefault(),dropZone.classList.remove('dragover');const t=e.dataTransfer.files[0];t&&('application/zip'===t.type||t.name.endsWith('.zip')?processZipFile(t):'text/plain'===t.type||t.name.endsWith('.txt')?processTextFile(t):showError('Please upload a valid ZIP or TXT file'))}async function processZipFile(e){showLoading();try{const t=window.zip,o=new t.ZipReader(new t.BlobReader(e)),n=await o.getEntries();let i='';for(const e of n)if(e.filename.endsWith('.txt')&&!e.filename.startsWith('__MACOSX')){const o=new t.TextWriter;i=await e.getData(o);break}if(await o.close(),!i)throw new Error('No chat text file found in the archive');const s=analyzeEmojis(i);displayResults(s)}catch(e){console.error('Error processing file:',e),showError(e.message||'Failed to process the ZIP file')}}async function processTextFile(e){showLoading();try{const t=await e.text();if(console.log('Processing text file:',e.name),!t)throw new Error('File is empty');const o=analyzeEmojis(t);displayResults(o)}catch(e){console.error('Error processing text file:',e),showError(e.message||'Failed to process the text file')}}function analyzeEmojis(e){console.log('Analyzing content length:',e.length),console.log('First 200 chars:',e.substring(0,200));const t=new Intl.Segmenter('en',{granularity:'grapheme'}),o=Array.from(t.segment(e)),n=o.filter(e=>/\p{Emoji_Presentation}|\p{Extended_Pictographic}/u.test(e.segment)&&!/^\d$/.test(e.segment)),i={};n.forEach(e=>{const t=e.segment;i[t]=(i[t]||0)+1});const s=Object.entries(i).sort((e,t)=>t[1]-e[1]);return console.log('Total emojis found:',n.length),console.log('Unique emojis:',Object.keys(i).length),console.log('Top 5 emojis:',s.slice(0,5)),{totalEmojis:n.length,uniqueEmojis:Object.keys(i).length,topEmoji:s[0]||['-',0],emojiList:s}}function displayResults(e){document.getElementById('total-emojis').textContent=e.totalEmojis.toLocaleString(),document.getElementById('unique-emojis').textContent=e.uniqueEmojis.toLocaleString(),document.getElementById('top-emoji').textContent=e.topEmoji[0],createChart(e.emojiList.slice(0,20)),createEmojiList(e.emojiList),hideAll(),resultsSection.classList.remove('hidden')}function createChart(e){const t=document.getElementById('emoji-chart').getContext('2d');emojiChart&&emojiChart.destroy();const o=document.getElementById('emoji-chart'),n=document.querySelector('.chart-wrapper');o.style.width='100%',n.style.width='100%';const i=e.map(e=>e[0]),s=e.map(e=>e[1]);emojiChart=new Chart(t,{type:'bar',data:{labels:i,datasets:[{label:'Count',data:s,backgroundColor:'#25D366',borderColor:'#128C7E',borderWidth:1,borderRadius:8}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:'Top 20 Most Used Emojis',font:{size:18,weight:'600'},color:'#075E54'}},scales:{y:{beginAtZero:!0,ticks:{precision:0}},x:{ticks:{font:{size:20}}}}}})}function createEmojiList(e){const t=document.getElementById('emoji-list');t.innerHTML=`<h3 style="margin-bottom: 20px; color: #075E54;">All Emojis (${e.length} total)</h3>`;const o=e[0]?e[0][1]:1;e.forEach((e,n)=>{const[i,s]=e,a=s/o*100,l=document.createElement('div');l.className='emoji-item',l.innerHTML=`\n            <div style="display: flex; align-items: center; gap: 15px;">\n                <span style="font-weight: 600; color: #667781; min-width: 30px;">#${n+1}</span>\n                <span class="emoji-char">${i}</span>\n            </div>\n            <div class="emoji-count">\n                <div class="count-bar" style="width: ${a}px;"></div>\n                <span class="count-number">${s.toLocaleString()}</span>\n            </div>\n        `,t.appendChild(l)})}function showLoading(){hideAll(),loadingSection.classList.remove('hidden')}function showError(e){hideAll(),errorMessage.textContent=e,errorSection.classList.remove('hidden')}function hideAll(){uploadSection.classList.add('hidden'),loadingSection.classList.add('hidden'),resultsSection.classList.add('hidden'),errorSection.classList.add('hidden')}function resetAnalysis(){hideAll(),uploadSection.classList.remove('hidden'),fileInput.value='',emojiChart&&(emojiChart.destroy(),emojiChart=null)}function showExportModal(e){e.preventDefault(),exportModal.classList.remove('hidden')}function hideExportModal(){exportModal.classList.add('hidden')}
    </script>
</body>
</html>